<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Khushi ❤️</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>

<body>

<video id="video" autoplay playsinline style="display:none"></video>
<canvas id="canvas"></canvas>

<script>
/* ========== CANVAS ========== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* ========== PARTICLES ========== */
const particles = [];
const COUNT = 800;

class Particle {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.tx = Math.random() * canvas.width;
    this.ty = Math.random() * canvas.height;
    this.vx = 0;
    this.vy = 0;
  }

  update() {
    this.vx += (this.tx - this.x) * 0.005;
    this.vy += (this.ty - this.y) * 0.005;
    this.vx *= 0.9;
    this.vy *= 0.9;
    this.x += this.vx;
    this.y += this.vy;
  }

  draw() {
    ctx.fillStyle = "#ff6fae";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
    ctx.fill();
  }
}

for (let i = 0; i < COUNT; i++) {
  particles.push(new Particle());
}

/* ========== DEFAULT MOTION (CRITICAL FIX) ========== */
function scatter() {
  particles.forEach(p => {
    p.tx = Math.random() * canvas.width;
    p.ty = Math.random() * canvas.height;
  });
}
scatter();

/* ========== ANIMATION LOOP ========== */
function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  particles.forEach(p => {
    p.update();
    p.draw();
  });

  requestAnimationFrame(animate);
}
animate();

/* ========== HAND TRACKING ========== */
const video = document.getElementById("video");

const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results => {
  if (!results.multiHandLandmarks) return;

  const lm = results.multiHandLandmarks[0];

  const indexUp = lm[8].y < lm[6].y;
  const middleUp = lm[12].y < lm[10].y;
  const ringUp = lm[16].y < lm[14].y;
  const pinkyUp = lm[20].y < lm[18].y;

  if (indexUp && middleUp && ringUp && pinkyUp) {
    makeHeart();
  } else if (!indexUp && !middleUp && !ringUp && !pinkyUp) {
    makeText("I LOVE YOU KHUSHI");
  } else if (indexUp && !middleUp && !ringUp && !pinkyUp) {
    scatter();
  }
});

/* ========== SHAPES ========== */
function makeHeart() {
  let points = [];
  for (let t = 0; t < Math.PI * 2; t += 0.05) {
    let x = 16 * Math.pow(Math.sin(t), 3);
    let y = -(13 * Math.cos(t)
      - 5 * Math.cos(2*t)
      - 2 * Math.cos(3*t)
      - Math.cos(4*t));
    points.push({
      x: canvas.width/2 + x * 12,
      y: canvas.height/2 + y * 12
    });
  }
  assign(points);
}

function makeText(text) {
  const temp = document.createElement("canvas");
  const tctx = temp.getContext("2d");
  temp.width = canvas.width;
  temp.height = canvas.height;

  tctx.font = "bold 80px Arial";
  tctx.fillStyle = "white";
  tctx.textAlign = "center";
  tctx.fillText(text, canvas.width/2, canvas.height/2);

  const data = tctx.getImageData(0,0,temp.width,temp.height).data;
  let points = [];

  for (let y = 0; y < temp.height; y += 6) {
    for (let x = 0; x < temp.width; x += 6) {
      if (data[(y*temp.width+x)*4+3] > 150) {
        points.push({x,y});
      }
    }
  }
  assign(points);
}

function assign(points) {
  particles.forEach((p,i) => {
    const t = points[i % points.length];
    p.tx = t.x;
    p.ty = t.y;
  });
}

/* ========== CAMERA START ========== */
const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});
camera.start();

</script>
</body>
</html>

